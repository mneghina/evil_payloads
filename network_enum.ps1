$ts=Get-Date -Format "yyyyMMdd_HHmmss"; $outDir=(Test-Path 'C:\Temp')?'C:\Temp':$env:TEMP; $out="$outDir\PassiveEnum_$ts.txt"; "=== Passive Network Enumeration ($env:COMPUTERNAME) @ $(Get-Date -Format o) ===" | Out-File -FilePath $out -Encoding UTF8; "`n--- IP Configuration ---" | Out-File $out -Append; ((Get-Command Get-NetIPConfiguration -ErrorAction SilentlyContinue)?{Get-NetIPConfiguration | Format-Table -Auto | Out-String}:{ipconfig /all | Out-String}) | Out-File $out -Append; "`n--- Routes ---" | Out-File $out -Append; ((Get-Command Get-NetRoute -ErrorAction SilentlyContinue)?{Get-NetRoute | Sort-Object RouteMetric,DestinationPrefix | Format-Table -Auto | Out-String}:{route print | Out-String}) | Out-File $out -Append; "`n--- ARP Cache ---" | Out-File $out -Append; ((Get-Command Get-NetNeighbor -ErrorAction SilentlyContinue)?{Get-NetNeighbor | Format-Table -Auto | Out-String}:{arp -a | Out-String}) | Out-File $out -Append; "`n--- Netstat (TCP/UDP with PIDs) ---" | Out-File $out -Append; (netstat -ano | Out-String) | Out-File $out -Append; "`n--- DNS Cache Snapshot ---" | Out-File $out -Append; (ipconfig /displaydns | Out-String) | Out-File $out -Append; "`n--- WinHTTP Proxy ---" | Out-File $out -Append; (netsh winhttp show proxy | Out-String) | Out-File $out -Append; "`n--- Time / NTP (w32tm) ---" | Out-File $out -Append; (w32tm /query /configuration | Out-String) | Out-File $out -Append; (w32tm /query /status | Out-String) | Out-File $out -Append; (w32tm /query /peers | Out-String) | Out-File $out -Append; "`n[Output saved to] $out" | Out-File $out -Append; Write-Host "Done. Output: $out" -ForegroundColor Green
